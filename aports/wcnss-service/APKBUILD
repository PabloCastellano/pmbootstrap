pkgname=wcnss-service
pkgver=1
pkgrel=0
pkgdesc="Initialize wifi on devices with wcnss driver"
url="https://android.googlesource.com/platform/hardware/qcom/wlan/+/master/qcwcn/wcnss-service/"
arch="all"
license="MIT"
depends=""
makedepends=""
subpackages=""
source="
    $pkgname.tar.gz::https://android.googlesource.com/platform/hardware/qcom/wlan/+archive/master/qcwcn/wcnss-service.tar.gz
    01_add_makefile.patch
    02_no_android.patch"
options=""


prepare() {
    local _patch_failed=
    cd "$ksrcdir"

    # first apply patches in specified order
    for i in $source; do
        case $i in
        *.patch)
            msg "Applying $i..."
            if ! patch -s -p1 -N -i "$srcdir"/$i; then
                echo $i >>failed
                _patch_failed=1
            fi
            ;;
        esac
    done

    if ! [ -z "$_patch_failed" ]; then
        error "The following patches failed:"
        cat failed
        return 1
    fi
}


build() {
	cd "$srcdir"
	make
}

package() {
	install -D -m755 "$srcdir"/wcnss_service \
		"$pkgdir"/bin/wcnss_service || return 1
}
sha512sums="ce359f1fe49d8f3162ceac5819897c496d4d04f8aedbc205214d7fdea264652ae03ef6ff01e72f4f01266318472c997faff26e7ec1393089f79702a7b1edbc3f  wcnss-service.tar.gz
2e94bfb0e38f24877d5460585965479d27a3d3e30fea1849e5824ada8082528cace8303d52b116a4334595ec8f696db515020665d00e4b7922f799823b9ec0ad  01_add_makefile.patch
0ffac184fb20a4d82e0de6d5f9fcd1a7ffcdcf9988194a95a968fef038ad24d21675eb61277b3782a8255135fb1b40c2582d18db64a8af6665c71216a01c8431  02_no_android.patch"
